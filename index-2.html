<!DOCTYPE html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="meta description">
    <title>Ananas - Shoes Store</title>
    <!--=== Favicon ===-->
    <link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon" />
    <!--=== All Plugins CSS ===-->
    <link href="assets/css/plugins.css" rel="stylesheet">
    <!--=== All Vendor CSS ===-->
    <link href="assets/css/vendor.css" rel="stylesheet">
    <!--=== Main Style CSS ===-->
    <link href="assets/css/style.css" rel="stylesheet">
    <!-- Modernizer JS -->
    <script src="assets/js/modernizr-2.8.3.min.js"></script>

</head>

<body>

    <!-- Start Header Area -->
    <header class="header-area">
        <!-- main header start -->
        <div class="main-header d-none d-lg-block">
            <!-- header middle area start -->
            <div class="header-main-area sticky">
                <div class="container">
                    <div class="row align-items-center position-relative">
                        <!-- start logo area -->
                        <div class="col-lg-2">
                            <div class="logo">
                                <a href="index-2.html">
                                    <img src="assets/img/logo/logo.png" alt="">
                                </a>
                            </div>
                        </div>
                        <!-- start logo area -->

                        <!-- main menu area start -->
                        <div class="col-lg-8 position-static">
                            <div class="main-menu-area">
                                <div class="main-menu">
                                    <!-- main menu navbar start -->
                                    <nav class="desktop-menu">
                                        <ul>
                                            <li class="active"><a href="index-2.html">Trang chủ </a></li>
                                            <li><a href="shop.html">Cửa hàng </a></li>
                                            <li><a href="contact-us.html">Liên hệ</a></li>
                                        </ul>
                                    </nav>
                                    <!-- main menu navbar end -->
                                </div>
                            </div>
                        </div>
                        <!-- main menu area end -->

                        <!-- mini cart area start -->
                        <div class="col-lg-2">
                            <div class="header-configure-wrapper">
                                <div class="header-configure-area">
                                    <ul class="nav justify-content-end">
                                        <li>
                                            <a href="#" class="offcanvas-btn">
                                                <i class="ion-ios-search-strong"></i>
                                            </a>
                                        </li>
                                        <li class="user-hover">
                                            <a href="#">
                                                <i class="ion-ios-gear-outline"></i>
                                            </a>
                                            <ul class="dropdown-list">
                                                <li><a href="login.html">Đăng nhập</a></li>
                                                <li><a href="register.html">Đăng ký</a></li>
                                                <li><a href="my-account.html">Tài khoản</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="#" class="minicart-btn">
                                                <i class="ion-bag"></i>
                                                <div class="notification" id="cart-quantity">0</div>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- mini cart area end -->
                    </div>
                </div>
            </div>
            <!-- header middle area end -->
        </div>
    </header>
    <!-- end Header Area -->

    <!-- off-canvas menu start -->
    <aside class="off-canvas-wrapper">
        <div class="off-canvas-overlay"></div>
        <div class="off-canvas-inner-content">
            <div class="btn-close-off-canvas">
                <i class="ion-android-close"></i>
            </div>

            <div class="off-canvas-inner">
                <!-- search box start -->
                <div class="search-box-offcanvas">
                    <form>
                        <input type="text" placeholder="Search Here...">
                        <button class="search-btn"><i class="ion-ios-search-strong"></i></button>
                    </form>
                </div>
                <!-- search box end -->
            </div>
        </div>
    </aside>
    <!-- off-canvas menu end -->
    <main>
        <!-- hero slider section start -->
        <section class="hero-slider">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="hero-slider-active slick-arrow-style slick-arrow-style_hero slick-dot-style">
                            <!-- single slider item start -->
                            <div class="hero-single-slide">
                                <div class="hero-slider-item bg-img" data-bg="assets/img/slider/slider-2.jpg">
                                    <div class="hero-slider-content slide-1">
                                        <h5 class="slide-subtitle">Top Selling!</h5>
                                        <h2 class="slide-title">New Collection</h2>
                                        <a href="shop.html" class="btn btn-hero">Mua ngay</a>
                                    </div>
                                </div>
                            </div>
                            <!-- single slider item end -->

                            <!-- single slider item start -->
                            <div class="hero-single-slide">
                                <div class="hero-slider-item bg-img" data-bg="assets/img/slider/slider-1.jpg">
                                    <div class="hero-slider-content slide-1">
                                        <h5 class="slide-subtitle">Best Selling!</h5>
                                        <h2 class="slide-title">Top Collection</h2>
                                        <a href="shop.html" class="btn btn-hero">Mua ngay</a>
                                    </div>
                                </div>
                            </div>
                            <!-- single slider item end -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- hero slider section end -->

        <!-- banner statistic area start -->
        <div class="banner-statistics mt-30">
            <div class="container">
                <div class="row mtn-30">
                    <div class="col-md-6">
                        <div class="img-container mt-30">
                            <a class="d-block" href="product-details.html">
                                <img class="w-100" src="assets/img/banner/banner-1.jpg" alt="banner-image">
                            </a>
                            <div class="banner-text">
                                <h5 class="banner-subtitle">sports shoes</h5>
                                <h3 class="banner-title">20% Off<br>For Sports men</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="img-container mt-30">
                            <a class="d-block" href="product-details.html">
                                <img class="w-100" src="assets/img/banner/banner-2.jpg" alt="banner-image">
                            </a>
                            <div class="banner-text">
                                <h5 class="banner-subtitle">sports shoes</h5>
                                <h3 class="banner-title">20% Off<br>For Sports men</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- banner statistic area end -->

        <!-- our product area start -->
        <section class="our-product mt-5 mb-5">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="section-title text-center">
                            <h2 class="title">Sản phẩm</h2>
                            <p class="sub-title">Bước vào thời đại, Đi cùng sự tự tin!</p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="product-carousel mbn-50 slick-row-15 slick-arrow-style slick-slider"
                            id="lastest-product-list">

                            <!-- product single item start -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- our product area end -->

        <!-- top seller area start -->
        <section class="top-seller-area mt-5 mb-5">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="section-title text-center">
                            <h2 class="title">Sản phẩm bán chạy</h2>
                            <p class="sub-title">Bước vào thời đại, Đi cùng sự tự tin!</p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xl-4 col-lg-5 col-md-5">
                        <div class="product-banner">
                            <a href="#">
                                <img src="assets/img/banner/banner-3.jpg" alt="product banner">
                            </a>
                        </div>
                    </div>
                    <div class="col-xl-8 col-lg-7 col-md-7">
                        <div class="top-seller-carousel slick-row-15 mtn-30" id="top-seller-list">
                            <!-- chỗ này để hiển thị các sản phẩm topseller -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- top seller area end -->

        <!-- service features start -->
        <section class="service-policy-area mt-5 mb-5">
            <div class="container">
                <div class="row mtn-30">
                    <!-- single policy item start -->
                    <div class="col-lg-4">
                        <div class="service-policy-item mt-30 bg-1">
                            <div class="policy-icon">
                                <img src="assets/img/icon/policy-1.png" alt="policy icon">
                            </div>
                            <div class="policy-content">
                                <h5 class="policy-title">FREE SHIPPING</h5>
                                <p class="policy-desc">Miễn phí ship trên tất cả đơn hàng</p>
                            </div>
                        </div>
                    </div>
                    <!-- single policy item start -->

                    <!-- single policy item start -->
                    <div class="col-lg-4">
                        <div class="service-policy-item mt-30 bg-2">
                            <div class="policy-icon">
                                <img src="assets/img/icon/policy-2.png" alt="policy icon">
                            </div>
                            <div class="policy-content">
                                <h5 class="policy-title">ONLINE SUPPORT</h5>
                                <p class="policy-desc">Hỗ trợ 24/24</p>
                            </div>
                        </div>
                    </div>
                    <!-- single policy item start -->

                    <!-- single policy item start -->
                    <div class="col-lg-4">
                        <div class="service-policy-item mt-30 bg-3">
                            <div class="policy-icon">
                                <img src="assets/img/icon/policy-3.png" alt="policy icon">
                            </div>
                            <div class="policy-content">
                                <h5 class="policy-title">MONEY RETURN</h5>
                                <p class="policy-desc">Hoàn tiền dưới 3 ngày</p>
                            </div>
                        </div>
                    </div>
                    <!-- single policy item start -->
                </div>
            </div>
        </section>
        <!-- service features end -->
    </main>
    <!-- main wrapper end -->

    <!-- modal quickview -->
    <div class="modal fade" id="quick_view" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        style="margin-top: 5px;"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Image Section -->
                        <div class="col-md-6">
                            <div class="product-large-slider" style="position: relative; overflow: hidden;">
                                <img id="mainImage" src="" alt="Product Image" class="img-fluid zoomable">
                            </div>
                            <div class="product-thumbnails mt-3 d-flex">
                                <!-- Thumbnail Images -->
                                <img id="thumb1" src="" alt="Thumbnail 1" class="img-thumbnail me-2 thumbnail"
                                    style="cursor: pointer;">
                                <img id="thumb2" src="" alt="Thumbnail 2" class="img-thumbnail me-2 thumbnail"
                                    style="cursor: pointer;">
                                <img id="thumb3" src="" alt="Thumbnail 3" class="img-thumbnail me-2 thumbnail"
                                    style="cursor: pointer;">
                            </div>
                        </div>
                        <!-- Details Section -->
                        <div class="col-md-6">
                            <div class="product-details">
                                <h5 style="margin-bottom: 10px;" class="modal-title" id="productName">Product Name</h5>
                                <p style="margin-bottom: 10px;" id="reviews"><span>1 Review(s)</span></p>
                                <div style="margin-bottom: 10px;" class="price-box">
                                    <span id="currentPrice" class="price-regular">$70.00</span>
                                    <span id="oldPrice" class="price-old text-muted"><del>$80.00</del></span>
                                </div>
                                <p style="margin-bottom: 10px;" id="description">Lorem ipsum dolor sit amet, consectetur
                                    adipiscing elit.</p>
                                <div class="availability">
                                    <strong>Availability:</strong> <span id="availability" class="text-success">In
                                        Stock</span>
                                </div>
                                <div style="margin-bottom: 10px;" class="quantity mt-3">
                                    <label for="quantityInput">Quantity:</label>
                                    <input id="quantityInput" type="number" value="1" min="1"
                                        class="form-control w-25 d-inline">
                                    <button id="addToCart" class="btn btn-dark ms-2">Add to Cart</button>
                                </div>
                                <div style="margin-bottom: 10px;" class="social-share mt-3">
                                    <strong>Share:</strong>
                                    <a href="#" class="ms-2"><i class="ion-social-facebook"></i></a>
                                    <a href="#" class="ms-2"><i class="ion-social-twitter"></i></a>
                                    <a href="#" class="ms-2"><i class="ion-social-pinterest"></i></a>
                                    <a href="#" class="ms-2"><i class="ion-social-googleplus"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end modal quickview-->


    <!-- Start Footer Area Wrapper -->
    <footer class="footer-wrapper">
        <!-- footer main area start -->
        <div class="footer-widget-area mt-5">
            <div class="container">
                <div class="row mtn-4">
                    <!-- footer widget item start -->
                    <div class="col-xl-5 col-lg-3 col-md-6">
                        <div class="widget-item mt-4">
                            <h5 class="widget-title">Thông tin liên hệ</h5>
                            <div class="widget-body">
                                <ul class="location-wrap">
                                    <li><i class="ion-ios-location-outline"></i>Minh Khai Ward, Bac Tu Liem District,
                                        Hanoi City.</li>
                                    <li><i class="ion-ios-email-outline"></i>Mail: <a
                                            href="mailto:huongdao2322005@gmail.com">ananas@gmail.com</a></li>
                                    <li><i class="ion-ios-telephone-outline"></i>Phone: <a
                                            href="%2b0025425456554.html">+0123456789</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- footer widget item end -->


                </div>
            </div>
        </div>
        <!-- footer main area end -->


    </footer>
    <!-- End Footer Area Wrapper -->

    <!-- offcanvas search form start -->
    <div class="offcanvas-search-wrapper">
        <div class="offcanvas-search-inner">
            <div class="offcanvas-close">
                <i class="ion-android-close"></i>
            </div>
            <div class="container">
                <div class="offcanvas-search-box">
                    <form class="d-flex bdr-bottom w-100">
                        <input type="text" placeholder="Search entire storage here...">
                        <button class="search-btn"><i class="ion-ios-search-strong"></i>search</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- offcanvas search form end -->

    <!-- offcanvas mini cart start -->
    <div class="offcanvas-minicart-wrapper">
        <div class="minicart-inner">
            <div class="offcanvas-overlay"></div>
            <div class="minicart-inner-content">
                <div class="minicart-close">
                    <i class="ion-android-close"></i>
                </div>
                <div class="minicart-content-box">
                    <div class="minicart-item-wrapper">
                        <ul>

                        </ul>
                    </div>

                    <div class="minicart-pricing-box">
                        <ul>

                        </ul>
                    </div>

                    <div class="minicart-button">
                        <a href="cart.html"><i class="fa fa-shopping-cart"></i> view cart</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- offcanvas mini cart end -->

    <!-- Scroll to top start -->
    <div class="scroll-top not-visible">
        <i class="fa fa-angle-up"></i>
    </div>
    <!-- Scroll to Top End -->

    <!--=======================Javascript============================-->
    <!--=== All Vendor Js ===-->
    <script src="assets/js/vendor.js"></script>
    <!--=== All Plugins Js ===-->
    <script src="assets/js/plugins.js"></script>
    <!--=== Active Js ===-->
    <script src="assets/js/active.js"></script>


    <!--=================================================================-->

    <script type="text/javascript">
        const TOKEN = localStorage.getItem("token"); // Token lấy từ đâu đó (localStorage, session, v.v.)
        const userId = localStorage.getItem("userId");

        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token'); // Lấy token đăng nhập
            const id = localStorage.getItem('userId');
            const productContainer = document.querySelector('.product-carousel'); // Container chứa sản phẩm
            const topProductContainer = document.querySelector('.top-seller-carousel'); // Container chứa sản phẩm


            try {
                // Gọi API lấy danh sách sản phẩm
                const response = await fetch('http://localhost:8080/product?page=0&size=10', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error(`Error fetching products: ${response.statusText}`);
                }

                const data = await response.json();
                const products = data.result.result;

                console.log("product:", data);

                productContainer.innerHTML = '';


                for (const product of products) {
                    // Gọi API lấy danh sách ảnh của từng sản phẩm

                    let productImage = product.images && product.images.length > 0 ? product.images[0] : 'assets/img/default-image.jpg';

                    const productHTML = `
                        <div class="product-item mb-50">
                                    <div class="product-thumb">
                                        <a href="product-details.html?id=${product.productId}">
                                            <img src="http://localhost:8080/images/product/${product.images[0]}" alt="">
                                        </a>
                                    </div>
                                    <div class="product-content">
                                        <h5 class="product-name">
                                            <a href="product-details.html">${product.productName}</a>
                                        </h5>
                                        <div class="price-box">
                                            <span class="price-regular">${product.price * (100 - product.discount) / 100} VND</span>
                                            <span class="price-old"><del>${product.price}</del></span>
                                        </div>
                                        <div class="product-action-link">
                                            <a href="#" data-bs-toggle="tooltip" title="Wishlist"><i
                                                    class="ion-android-favorite-outline"></i></a>
                                            <a href="#" data-bs-toggle="tooltip" title="Add To Cart"><i
                                                    class="ion-bag"></i></a>
                                            <a href="#" data-bs-toggle="modal" data-bs-target="#quick_view" data-product-id="${product.productId}"> <span
                                                    data-bs-toggle="tooltip" title="Quick View"><i
                                                        class="ion-ios-eye-outline"></i></span> </a>
                                        </div>
                                    </div>
                                </div>
                    `;
                    const topProductHTML = `
                        <div class="slide-item">
                            <div class="pro-item-small mt-30">
                                <div class="product-thumb">
                                    <a href="product-details.html?id=${product.productId}">
                                        <img src="http://localhost:8080/images/product/${product.images[0]}" alt="${product.productName}" style="height: 180px; width: 169px;">
    
                                    </a>
                                </div>
                                <div class="pro-small-content">
                                    <h6 class="product-name">
                                        <a href="product-details.html?productId=${product.productId}">${product.productName}</a>
                                    </h6>
                                    <div class="price-box">
                                        <span class="price-regular">$${product.price.toFixed(2)}</span>
                                        ${product.discount ? `<span class="price-old"><del>$${product.discount.toFixed(2)}</del></span>` : ''}
                                    </div>
                                    <div class="ratings">
                                        ${'<span><i class="ion-android-star"></i></span>'.repeat(product.rating || 0)}
                                        ${'<span><i class="ion-android-star-outline"></i></span>'.repeat(5 - (product.rating || 0))}
                                    </div>
                                    <div class="product-link-2">
                                        <a href="#" data-bs-toggle="tooltip" title="Wishlist"><i class="ion-android-favorite-outline"></i></a>
                                        <a href="#" data-bs-toggle="tooltip" title="Add To Cart"><i class="ion-bag"></i></a>
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#quick_view" data-product-id="${product.productId}"> <span
                                                    data-bs-toggle="tooltip" title="Quick View"><i
                                                        class="ion-ios-eye-outline"></i></span> </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    productContainer.insertAdjacentHTML('beforeend', productHTML);
                    topProductContainer.insertAdjacentHTML('beforeend', topProductHTML);
                }

                // Khởi tạo slider sau khi thêm sản phẩm
                $('.product-carousel').slick({
                    slidesToShow: 4, // Hiển thị 4 sản phẩm
                    infinite: true,
                    arrows: true, // Hiển thị nút điều hướng
                    prevArrow: '<button type="button" class="slick-prev"><i class="fa fa-angle-left"></i></button>',
                    nextArrow: '<button type="button" class="slick-next"><i class="fa fa-angle-right"></i></button>',
                    responsive: [
                        {
                            breakpoint: 1024,
                            settings: {
                                slidesToShow: 3
                            }
                        },
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: 2
                            }
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: 1
                            }
                        }
                    ]
                });

                // blog carousel active-2 js
                $('.top-seller-carousel').slick({
                    rows: 2,
                    arrows: false,
                    slidesToShow: 2,
                    responsive: [
                        {
                            breakpoint: 1600, // Màn hình lớn hơn 1600px
                            settings: {
                                slidesToShow: 2 // Hiển thị 5 sản phẩm trên màn hình lớn hơn 1600px
                            }
                        },
                        {
                            breakpoint: 1400, // Màn hình lớn hơn 1400px
                            settings: {
                                slidesToShow: 2 // Hiển thị 4 sản phẩm trên màn hình lớn hơn 1400px
                            }
                        },
                        {
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: 1
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                rows: 1,
                                slidesToShow: 1
                            }
                        }
                    ]
                });

                // Nếu có token, gọi API lấy số lượng sản phẩm trong giỏ hàng
                if (token) {
                    try {
                        const quantityResponse = await fetch(`http://localhost:8080/cart/quantity?userId=${id}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json',
                            },
                        });

                        if (!quantityResponse.ok) {
                            throw new Error(`Error fetching cart quantity: ${quantityResponse.statusText}`);
                        }

                        const quantityData = await quantityResponse.json();
                        const numberOfProduct = quantityData.result;

                        console.log("Cart Quantity:", numberOfProduct);
                        document.getElementById('cart-quantity').innerText = numberOfProduct;
                    } catch (error) {
                        console.error('Error fetching cart quantity:', error);
                    }
                }

                // Add Quick View event listeners
                document.querySelectorAll('[data-bs-target="#quick_view"]').forEach(button => {
                    button.addEventListener('click', async (event) => {
                        const productId = event.currentTarget.getAttribute('data-product-id');
                        await fetchQuickViewProduct(productId, token);
                    });
                });
            } catch (error) {
                console.error('Error fetching products or images:', error);
            }

        });

        // Lấy chi tiết sản phẩm từ API và hiển thị vào modal
        async function fetchQuickViewProduct(productId, token) {
            try {
                const response = await fetch(`http://localhost:8080/product/${productId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Failed to fetch product details: ${response.statusText}`);
                }

                const data = await response.json();
                const product = data.result;

                // Hiển thị thông tin sản phẩm vào modal
                document.getElementById('productName').innerText = product.productName;
                document.getElementById('currentPrice').innerText = `$${(product.price * (100 - product.discount) / 100).toFixed(2)}`;
                document.getElementById('oldPrice').innerText = product.discount ? `$${product.price}` : '';
                document.getElementById('description').innerText = product.description;
                document.getElementById('availability').innerText = product.soldQuantity > 0 ? 'In Stock' : 'Out of Stock';
                document.getElementById('availability').classList.toggle('text-success', product.soldQuantity > 0);
                document.getElementById('availability').classList.toggle('text-danger', product.soldQuantity === 0);

                // Cập nhật hình ảnh chính và hình ảnh thumbnail
                const mainImage = product.images && product.images[0] ? `http://localhost:8080/images/product/${product.images[0]}` : 'http://localhost:8080/images/product/default-image.jpg';
                document.getElementById('mainImage').src = mainImage;

                const thumbnails = product.images || [];
                document.getElementById('thumb1').src = thumbnails[0] ? `http://localhost:8080/images/product/${thumbnails[0]}` : 'http://localhost:8080/images/product/default-image.jpg';
                document.getElementById('thumb2').src = thumbnails[1] ? `http://localhost:8080/images/product/${thumbnails[1]}` : 'http://localhost:8080/images/product/default-image.jpg';
                document.getElementById('thumb3').src = thumbnails[2] ? `http://localhost:8080/images/product/${thumbnails[2]}` : 'http://localhost:8080/images/product/default-image.jpg';
                document.getElementById('thumb4').src = thumbnails[3] ? `http://localhost:8080/images/product/${thumbnails[3]}` : 'http://localhost:8080/images/product/default-image.jpg';

                // Hiển thị modal
                const quickViewModal = new bootstrap.Modal(document.getElementById('quick_view'));
                quickViewModal.show();
            } catch (error) {
                console.error('Error fetching product details:', error);
            }
        }

        // Thêm sự kiện cho các nút Quick View
        document.querySelectorAll('[data-bs-target="#quick_view"]').forEach(button => {
            button.addEventListener('click', (event) => {
                const productId = event.currentTarget.getAttribute('data-product-id');
                const token = localStorage.getItem('token'); // Token từ localStorage
                if (token) {
                    fetchQuickViewProduct(productId, token);
                } else {
                    alert('You need to log in to view this product!');
                }
            });
        });

        // Phóng to ảnh chính khi di chuột
        const mainImage = document.getElementById('mainImage');
        const thumbnails = document.querySelectorAll('.thumbnail');

        // Thay đổi ảnh chính khi bấm vào thumbnail
        thumbnails.forEach(thumbnail => {
            thumbnail.addEventListener('click', (event) => {
                const newImageSrc = event.target.src;
                mainImage.src = newImageSrc;
            });
        });

        // Di chuột để phóng to vùng ảnh
        mainImage.addEventListener('mousemove', (event) => {
            const bounds = mainImage.getBoundingClientRect();
            const xPercent = ((event.clientX - bounds.left) / bounds.width) * 100;
            const yPercent = ((event.clientY - bounds.top) / bounds.height) * 100;
            mainImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
        });

        mainImage.addEventListener('mouseleave', () => {
            mainImage.style.transformOrigin = 'center center';
        });

        function renderMiniCart(cartItems, summary) {
            const cartWrapper = document.querySelector(".minicart-item-wrapper ul");
            const pricingBox = document.querySelector(".minicart-pricing-box ul");

            // Làm rỗng nội dung cũ
            cartWrapper.innerHTML = "";
            pricingBox.innerHTML = "";
            var tem = 1;
            // Render từng sản phẩm
            cartItems.forEach(item => {
                const product = item.product;
                const quantity = item.quantity;

                const cartItemHTML = `
            <li class="minicart-item">
                <div class="minicart-thumb">
                    <a href="/product-details.html?variantId=${tem}">
                        <img src="file:///E:/Cntt_Class/JavaWeb/background" alt="${product.productName}">
                    </a>
                </div>
                <div class="minicart-content">
                    <h3 class="product-name">
                        <a href="/product-details.html?variantId=${tem}">${product.productName}</a>
                    </h3>
                    <p>
                        <span class="cart-quantity">${quantity} <strong>&times;</strong></span>
                        <span class="cart-price">$${(quantity * 100).toFixed(2)}</span>
                    </p>
                </div>
                <button class="minicart-remove"><i class="ion-android-close"></i></button>
            </li>
        `;
                cartWrapper.innerHTML += cartItemHTML;
            });

            // Render tổng giá trị
            pricingBox.innerHTML += `
        <li><span>sub-total</span><span><strong>$${summary.totalPrice.toFixed(2)}</strong></span></li>
        <li><span>VAT (10%)</span><span><strong>$${(summary.totalPrice * 0.1).toFixed(2)}</strong></span></li>
        <li class="total"><span>total</span><span><strong>$${(summary.totalPrice * 1.1).toFixed(2)}</strong></span></li>
    `;
        }

        async function fetchCartItems(userId) {
            try {
                const response = await fetch(`http://localhost:8080/cart?userId=${userId}`, {
                    method: "GET",
                    headers: {
                        "Authorization": TOKEN,
                        "Content-Type": "application/json"
                    }
                });
                const data = await response.json();
                if (data.code === 200) {
                    return data.result;
                } else {
                    throw new Error(data.message || "Failed to fetch cart items.");
                }
            } catch (error) {
                console.error("Error fetching cart items:", error);
                return [];
            }
        }

        async function fetchCartSummary(userId) {
            try {
                const [quantityRes, priceRes] = await Promise.all([
                    fetch(`http://localhost:8080/cart/quantity?userId=${userId}`, {
                        method: "GET",
                        headers: {
                            "Authorization": TOKEN,
                            "Content-Type": "application/json"
                        }
                    }).then(res => res.json()),
                    fetch(`http://localhost:8080/cart/sumprice?userId=${userId}`, {
                        method: "GET",
                        headers: {
                            "Authorization": TOKEN,
                            "Content-Type": "application/json"
                        }
                    }).then(res => res.json())
                ]);
                return {
                    totalQuantity: quantityRes,
                    totalPrice: priceRes
                };
            } catch (error) {
                console.error("Error fetching cart summary:", error);
                return { totalQuantity: 0, totalPrice: 0 };
            }
        }


        document.addEventListener("DOMContentLoaded", async () => {

            // Gọi API lấy dữ liệu
            const cartItems = await fetchCartItems(userId);
            const cartSummary = await fetchCartSummary(userId);

            // Render dữ liệu ra giao diện
            renderMiniCart(cartItems, cartSummary);
        });

        document.addEventListener("click", async (event) => {
            if (event.target.classList.contains("minicart-remove")) {
                const productElement = event.target.closest(".minicart-item");
                const variantId = productElement.querySelector("a").href.split("variantId=")[1];

                try {
                    await fetch(`http://localhost:8080/cart/remove?variantId=${variantId}`, {
                        method: "DELETE",
                        headers: {
                            "Authorization": TOKEN,
                            "Content-Type": "application/json"
                        }
                    });
                    productElement.remove(); // Xóa khỏi giao diện
                } catch (error) {
                    console.error("Error removing cart item:", error);
                }
            }
        });

    </script>
</body>

</html>

<style>
    /* modal */
    .img-thumbnail {
        width: 60px;
        height: 60px;
    }

    .price-box .price-regular {
        font-size: 18px;
        font-weight: bold;
        color: #000;
    }

    .price-box .price-old {
        font-size: 16px;
        text-decoration: line-through;
    }

    .availability span {
        font-weight: bold;
    }

    .product-item {
        margin: 0 10px;
        text-align: center;
    }

    .product-thumb img {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
    }

    .zoomable {
        transition: transform 0.2s ease-in-out;
        cursor: zoom-in;
    }

    .product-large-slider:hover .zoomable {
        transform: scale(2);
        /* Phóng to khi hover */
        cursor: zoom-out;
    }

    .thumbnail {
        cursor: pointer;
    }

    .product-large-slider {
        position: relative;
        overflow: hidden;
    }



    /* our product */
    .slick-prev,
    .slick-next {
        background: #000;
        color: #fff;
        border-radius: 50%;
        margin: 10px;
        width: 50px;
        height: 50px;
    }

    .slick-next {
        right: -50px;
    }

    .slick-prev {
        left: -50px;
    }

    .slick-prev:hover,
    .slick-next:hover {
        background: #ff5722;
    }


    /* top seller */
</style>