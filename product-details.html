<!DOCTYPE html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="meta description">
    <title>Ananas - Shoes Store</title>
    <!--=== Favicon ===-->
    <link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon" />
    <!--=== All Plugins CSS ===-->
    <link href="assets/css/plugins.css" rel="stylesheet">
    <!--=== All Vendor CSS ===-->
    <link href="assets/css/vendor.css" rel="stylesheet">
    <!--=== Main Style CSS ===-->
    <link href="assets/css/style.css" rel="stylesheet">
    <!-- Modernizer JS -->
    <script src="assets/js/modernizr-2.8.3.min.js"></script>

    <!--[if lt IE 9]>
<script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>

    <!-- Start Header Area -->
    <header class="header-area">
        <!-- main header start -->
        <div class="main-header d-none d-lg-block">
            

            <!-- header middle area start -->
            <div class="header-main-area sticky">
                <div class="container">
                    <div class="row align-items-center position-relative">
                        <!-- start logo area -->
                        <div class="col-lg-2">
                            <div class="logo">
                                <a href="index-2.html">
                                    <img src="assets/img/logo/logo.png" alt="">
                                </a>
                            </div>
                        </div>
                        <!-- start logo area -->

                        <!-- main menu area start -->
                        <div class="col-lg-8 position-static">
                            <div class="main-menu-area">
                                <div class="main-menu">
                                    <!-- main menu navbar start -->
                                    <nav class="desktop-menu">
                                        <ul>
                                            <li><a href="index-2.html">Trang chủ </a></li>
                                            <li class="active"><a href="shop.html">Cửa hàng</a></li>
                                            <li><a href="contact-us.html">Liên hệ</a></li>
                                        </ul>
                                    </nav>
                                    <!-- main menu navbar end -->
                                </div>
                            </div>
                        </div>
                        <!-- main menu area end -->

                        <!-- mini cart area start -->
                        <div class="col-lg-2">
                            <div class="header-configure-wrapper">
                                <div class="header-configure-area">
                                    <ul class="nav justify-content-end">
                                        <li>
                                            <a href="#" class="offcanvas-btn">
                                                <i class="ion-ios-search-strong"></i>
                                            </a>
                                        </li>
                                        <li class="user-hover">
                                            <a href="#">
                                                <i class="ion-ios-gear-outline"></i>
                                            </a>
                                            <ul class="dropdown-list">
                                                <li><a href="login.html">Đăng nhập</a></li>
                                                <li><a href="register.html">Đăng ký</a></li>
                                                <li><a href="my-account.html">Tài khoản</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="#" class="minicart-btn">
                                                <i class="ion-bag"></i>
                                                <div class="notification" id="cart-quantity">0</div>
                                            </a>
                                        </li>
                                        <!-- Thêm ảnh user -->
                                        <li class="user-thumbnail">
                                            <a href="my-account.html">
                                                <img src="assets/img/about/avatar.jpg" alt="User" class="user-image">
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- mini cart area end -->
                    </div>
                </div>
            </div>
            <!-- header middle area end -->
        </div>
        <!-- main header start -->

        
    </header>
    <!-- end Header Area -->

    <!-- off-canvas menu start -->
    <aside class="off-canvas-wrapper">
        <div class="off-canvas-overlay"></div>
        <div class="off-canvas-inner-content">
            <div class="btn-close-off-canvas">
                <i class="ion-android-close"></i>
            </div>

            <div class="off-canvas-inner">
                <!-- search box start -->
                <div class="search-box-offcanvas">
                    <form>
                        <input type="text" placeholder="Search Here...">
                        <button class="search-btn"><i class="ion-ios-search-strong"></i></button>
                    </form>
                </div>
                <!-- search box end -->
            </div>
        </div>
    </aside>
    <!-- off-canvas menu end -->

    <!-- main wrapper start -->
    <main>

        <!-- product details wrapper start -->
        <div class="product-details-wrapper mt-5 mb-5">
            <div class="container custom-container">
                <div class="row">
                    <div class="col-12">
                        <!-- product details inner end -->
                        <div class="product-details-inner">
                            <div class="row">
                                <div class="col-lg-5">
                                        <div class="product-large-slider">
                                            <img id="mainImage" src="" alt="" class="img-fluid zoomable"/>
                                        </div>
                                        <!-- Các hình ảnh thumbnail sẽ được thêm vào động -->
                                        <div id="thumbnails" class="product-thumbnails mt-3 d-flex">
                                            <img id="thumb1" src="" alt="Thumbnail 1" class="img-thumbnail me-2 thumbnail" style="cursor: pointer;">
                                            <img id="thumb2" src="" alt="Thumbnail 2" class="img-thumbnail me-2 thumbnail" style="cursor: pointer;">
                                            <img id="thumb3" src="" alt="Thumbnail 3" class="img-thumbnail me-2 thumbnail" style="cursor: pointer;">
                                            <img id="thumb4" src="" alt="Thumbnail 4" class="img-thumbnail me-2 thumbnail" style="cursor: pointer;">
                                        </div>
                                </div>
                                <div class="col-lg-7">
                                    <div class="product-details-des">
                                        <h3 id="productName" class="pro-det-title"></h3>
                                        <div class="pro-review">
                                            <span><a href="#" id="reviews">1 Review(s)</a></span>
                                        </div>
                                        <div class="price-box">
                                            <span id="currentPrice" class="regular-price"></span>
                                            <span class="old-price"><del id="oldPrice"></del></span>
                                        </div>
                                        <p id="description"></p>
                                        
                                        <!-- Chọn màu -->
                                        <div class="color-selection mt-3">
                                            <label><strong>Color:</strong></label>
                                            <div class="d-flex mt-2">
                                                <div class="color-box me-2" style="background-color: white;" data-color="White">
                                                </div>
                                                <div class="color-box me-2" style="background-color: black;" data-color="Black">
                                                </div>
                                                <div class="color-box me-2" style="background-color: blue;" data-color="Blue">
                                                </div>
                                                <div class="color-box" style="background-color: red;" data-color="Red"></div>
                                            </div>
                                        </div>

                                        <!-- Chọn size -->
                                        <div class="size-selection mt-3">
                                            <label><strong>Size:</strong></label>
                                            <div class="d-flex mt-2">
                                                <div class="size-box me-2" data-size="37">37</div>
                                                <div class="size-box me-2" data-size="38">38</div>
                                                <div class="size-box me-2" data-size="39">39</div>
                                                <div class="size-box me-2" data-size="40">40</div>
                                                <div class="size-box me-2" data-size="41">41</div>
                                                <div class="size-box me-2" data-size="42">42</div>
                                                <div class="size-box me-2" data-size="43">43</div>
                                                <div class="size-box" data-size="44">44</div>
                                            </div>
                                        </div>
                                        <!-- Số lượng và nút thêm giỏ hàng -->
                                        <div style="margin-bottom: 10px;" class="quantity mt-3">
                                            <label for="quantityInput">Quantity:</label>
                                            <input id="quantityInput" type="number" value="1" min="1"
                                                class="form-control w-25 d-inline">
                                            <button id="addToCart2" class="btn btn-dark ms-2">Add to Cart</button>
                                        </div>
                                        <div class="share-icon">
                                            <h5 class="cat-title">Share:</h5>
                                            <a href="#"><i class="fa fa-facebook"></i></a>
                                            <a href="#"><i class="fa fa-twitter"></i></a>
                                            <a href="#"><i class="fa fa-pinterest"></i></a>
                                            <a href="#"><i class="fa fa-google-plus"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- product details inner end -->

                        <!-- product details reviews start -->
                        <div class="product-details-reviews mt-5 mb-5">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="product-review-info">
                                        <ul class="nav review-tab" role="tablist">
                                            <li>
                                                <button class="active" id="tab_one_btn" type="button" data-bs-toggle="tab" data-bs-target="#tab_one" role="tab" aria-controls="tab_one" aria-selected="true">Mô tả</button>
                                            </li>
                                            <li>
                                                <button id="tab_two_btn" type="button" data-bs-toggle="tab" data-bs-target="#tab_two" role="tab" aria-controls="tab_two" aria-selected="false">Thông tin</button>
                                            </li>
                                            <li>
                                                <button id="tab_three_btn" type="button" data-bs-toggle="tab" data-bs-target="#tab_three" role="tab" aria-controls="tab_three" aria-selected="false">Đánh giá</button>
                                            </li>
                                        </ul>
                                        <div class="tab-content reviews-tab">
                                            <div class="tab-pane fade show active" id="tab_one" role="tabpanel" aria-labelledby="tab_one_btn">
                                                <div class="tab-one">
                                                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam fringilla augue nec est tristique auctor. Ipsum metus feugiat sem, quis fermentum turpis eros eget velit. Donec ac tempus ante. Fusce ultricies massa massa. Fusce aliquam, purus eget sagittis vulputate, sapien libero hendrerit est, sed commodo augue nisi non neque.</p>
                                                    <div class="review-description">
                                                        <div class="tab-thumb">
                                                            <img src="assets/img/about/services.jpg" alt="">
                                                        </div>  
                                                        <div class="tab-des">
                                                            <p id="des"></p>
                                                        </div>
                                                    </div>
                                                    <p>Cras neque metus, consequat et blandit et, luctus a nunc. Etiam gravida vehicula tellus, in imperdiet ligula euismod eget. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nam erat mi, rutrum at sollicitudin rhoncus, ultricies posuere erat. Duis convallis, arcu nec aliquam consequat, purus felis vehicula felis, a dapibus enim lorem nec augue. Nunc facilisis sagittis ullamcorper.</p>
                                                    <p>Proin lectus ipsum, gravida et mattis vulputate, tristique ut lectus. Sed et lorem nunc. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aenean eleifend laoreet congue. Vivamus adipiscing nisl ut dolor dignissim semper. Nulla luctus malesuada tincidunt.</p>
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="tab_two" role="tabpanel" aria-labelledby="tab_two_btn">
                                            <table class="table table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th>Size</th>
                                                        <th>Color</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="product-variants">
                                                    <!-- Biến thể sẽ được thêm vào đây -->
                                                </tbody>
                                            </table>
                                        </div>
                                            <div class="tab-pane fade" id="tab_three" role="tabpanel" aria-labelledby="tab_three_btn">
                                                <form action="#" class="review-form">
                                                    <h5>1 review for <span>Chaz Kangeroo Hoodies</span></h5>
                                                    <div class="total-reviews">
                                                        <div class="rev-avatar">
                                                            <img src="assets/img/about/avatar.jpg" alt="">
                                                        </div>
                                                        <div class="review-box">
                                                            <div class="ratings">
                                                                <span class="good"><i class="fa fa-star"></i></span>
                                                                <span class="good"><i class="fa fa-star"></i></span>
                                                                <span class="good"><i class="fa fa-star"></i></span>
                                                                <span class="good"><i class="fa fa-star"></i></span>
                                                                <span><i class="fa fa-star"></i></span>
                                                            </div>
                                                            <div class="post-author">
                                                                <p><span>admin -</span> 30 Nov, 2018</p>
                                                            </div>
                                                            <p>Aliquam fringilla euismod risus ac bibendum. Sed sit amet sem varius ante feugiat lacinia. Nunc ipsum nulla, vulputate ut venenatis vitae, malesuada ut mi. Quisque iaculis, dui congue placerat pretium, augue erat accumsan lacus</p>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row mb-3">
                                                        <div class="col">
                                                            <label class="col-form-label"><span class="text-danger">*</span> Your Name</label>
                                                            <input type="text" class="form-control" required>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row mb-3">
                                                        <div class="col">
                                                            <label class="col-form-label"><span class="text-danger">*</span> Your Email</label>
                                                            <input type="email" class="form-control" required>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row mb-3">
                                                        <div class="col">
                                                            <label class="col-form-label"><span class="text-danger">*</span> Your Review</label>
                                                            <textarea class="form-control" required></textarea>
                                                            <div class="help-block pt-10"><span class="text-danger">Note:</span> HTML is not translated!</div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group row mb-3">
                                                        <div class="col">
                                                            <label class="col-form-label"><span class="text-danger">*</span> Rating</label>
                                                            &nbsp;&nbsp;&nbsp; Bad&nbsp;
                                                            <input type="radio" value="1" name="rating">
                                                            &nbsp;
                                                            <input type="radio" value="2" name="rating">
                                                            &nbsp;
                                                            <input type="radio" value="3" name="rating">
                                                            &nbsp;
                                                            <input type="radio" value="4" name="rating">
                                                            &nbsp;
                                                            <input type="radio" value="5" name="rating" checked>
                                                            &nbsp;Good
                                                        </div>
                                                    </div>
                                                    <div class="buttons">
                                                        <button class="sqr-btn" type="submit">Continue</button>
                                                    </div>
                                                </form> <!-- end of review-form -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> 
                        <!-- product details reviews end --> 

                        <!-- featured product area start -->
                        <section class="Related-product">
                            <div class="container">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="section-title text-center">
                                            <h2 class="title">Có thể bạn quan tâm</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="product-carousel mbn-50 slick-row-15 slick-arrow-style slick-slider" id="lastest-product-list">

                                            <!-- product single item start -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- featured product area end -->
                    </div>
                </div>
            </div>
        </div>
        <!-- product details wrapper end -->
    </main>
    <!-- main wrapper end -->

    <!-- modal quickview -->
    <div class="modal fade" id="quick_view" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="margin-top: 5px;"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Image Section -->
                        <div class="col-md-6">
                            <div class="product-large-slider" style="position: relative; overflow: hidden;">
                                <img id="mainImage-1" src="" alt="Product Image" class="img-fluid zoomable">
                            </div>
                            <div class="product-thumbnails mt-3 d-flex">
                                <!-- Thumbnail Images -->
                                <img style="width: 90px; height: 80px;" id="thumb1-1" src="" alt="Thumbnail 1" class="img-thumbnail me-2 thumbnail-1" style="cursor: pointer;">
                                <img style="width: 90px; height: 80px;" id="thumb2-1" src="" alt="Thumbnail 2" class="img-thumbnail me-2 thumbnail-1" style="cursor: pointer;">
                                <img style="width: 90px; height: 80px;" id="thumb3-1" src="" alt="Thumbnail 3" class="img-thumbnail me-2 thumbnail-1" style="cursor: pointer;">
                                <img style="width: 90px; height: 80px;" id="thumb4-1" src="" alt="Thumbnail 4" class="img-thumbnail me-2 thumbnail-1" style="cursor: pointer;">
                            </div>
                        </div>
                        <!-- Details Section -->
                        <div class="col-md-6">
                            <div class="product-details">
                                <h5 style="margin-bottom: 10px;" class="modal-title" id="productName-1">Product Name</h5>
                                <p style="margin-bottom: 10px;" id="reviews"><span>1 Review(s)</span></p>
                                <div style="margin-bottom: 10px;" class="price-box">
                                    <span id="currentPrice-1" class="price-regular">$70.00</span>
                                    <span id="oldPrice-1" class="price-old text-muted"><del>$80.00</del></span>
                                </div>
                                <p style="margin-bottom: 10px;" id="description-1">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                                <div class="availability">
                                    <strong>Availability:</strong> <span id="availability" class="text-success">In Stock</span>
                                </div>
                                <div id="qvId" style="display: none;"></div>

                                <!-- Chọn màu -->
                                <div class="color-selection mt-3">
                                    <label><strong>Color:</strong></label>
                                    <div class="d-flex mt-2">
                                        <div class="color-box me-2" style="background-color: white;" data-color="White">
                                        </div>
                                        <div class="color-box me-2" style="background-color: black;" data-color="Black">
                                        </div>
                                        <div class="color-box me-2" style="background-color: blue;" data-color="Blue">
                                        </div>
                                        <div class="color-box" style="background-color: red;" data-color="Red"></div>
                                    </div>
                                </div>

                                <!-- Chọn size -->
                                <div class="size-selection mt-3">
                                    <label><strong>Size:</strong></label>
                                    <div class="d-flex mt-2">
                                        <div class="size-box me-2" data-size="37">37</div>
                                        <div class="size-box me-2" data-size="38">38</div>
                                        <div class="size-box me-2" data-size="39">39</div>
                                        <div class="size-box me-2" data-size="40">40</div>
                                        <div class="size-box me-2" data-size="41">41</div>
                                        <div class="size-box me-2" data-size="42">42</div>
                                        <div class="size-box me-2" data-size="43">43</div>
                                        <div class="size-box" data-size="44">44</div>
                                    </div>
                                </div>

                                <!-- Số lượng và nút thêm giỏ hàng -->
                                <div style="margin-bottom: 10px;" class="quantity mt-3">
                                    <label for="quantityInput">Quantity:</label>
                                    <input id="quantityInput" type="number" value="1" min="1"
                                        class="form-control w-25 d-inline">
                                    <button id="addToCart" class="btn btn-dark ms-2">Add to Cart</button>
                                </div>
                                
                                <div style="margin-bottom: 10px;" class="social-share mt-3">
                                    <strong>Share:</strong>
                                    <a href="#" class="ms-2"><i class="ion-social-facebook"></i></a>
                                    <a href="#" class="ms-2"><i class="ion-social-twitter"></i></a>
                                    <a href="#" class="ms-2"><i class="ion-social-pinterest"></i></a>
                                    <a href="#" class="ms-2"><i class="ion-social-googleplus"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
     <!-- end modal quickview-->

    <!-- Start Footer Area Wrapper -->
    <footer class="footer-wrapper">
        <!-- footer main area start -->
        <div class="footer-widget-area mt-5">
            <div class="container">
                <div class="row mtn-4">
                    <!-- footer widget item start -->
                    <div class="col-xl-5 col-lg-3 col-md-6">
                        <div class="widget-item mt-4">
                            <h5 class="widget-title">Thông tin liên hệ</h5>
                            <div class="widget-body">
                                <ul class="location-wrap">
                                    <li><i class="ion-ios-location-outline"></i>Minh Khai Ward, Bac Tu Liem District, Hanoi City.</li>
                                    <li><i class="ion-ios-email-outline"></i>Mail: <a href="mailto:yourmail@gmail.com">yourmail@gmail.com</a></li>
                                    <li><i class="ion-ios-telephone-outline"></i>Phone: <a href="%2b0025425456554.html">+0123456789</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- footer widget item end -->
                </div>
            </div>
        </div>
        <!-- footer main area end -->

        
    </footer>
    <!-- End Footer Area Wrapper -->

    <!-- offcanvas search form start -->
    <div class="offcanvas-search-wrapper">
        <div class="offcanvas-search-inner">
            <div class="offcanvas-close">
                <i class="ion-android-close"></i>
            </div>
            <div class="container">
                <div class="offcanvas-search-box">
                    <form class="d-flex bdr-bottom w-100">
                        <input type="text" placeholder="Search entire storage here...">
                        <button class="search-btn"><i class="ion-ios-search-strong"></i>search</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- offcanvas search form end -->

    <!-- offcanvas mini cart start -->
    <div class="offcanvas-minicart-wrapper">
        <div class="minicart-inner">
            <div class="offcanvas-overlay"></div>
            <div class="minicart-inner-content">
                <div class="minicart-close">
                    <i class="ion-android-close"></i>
                </div>
                <div class="minicart-content-box">
                    <div class="minicart-item-wrapper">
                        <ul>

                        </ul>
                    </div>

                    <div class="minicart-pricing-box">
                        <ul>

                        </ul>
                    </div>

                    <div class="minicart-button">
                        <a href="cart.html"><i class="fa fa-shopping-cart"></i> view cart</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- offcanvas mini cart end -->

    <!-- Scroll to top start -->
    <div class="scroll-top not-visible">
        <i class="fa fa-angle-up"></i>
    </div>
    <!-- Scroll to Top End -->

    <!--=======================Javascript============================-->
    <!--=== All Vendor Js ===-->
    <script src="assets/js/vendor.js"></script>
    <!--=== All Plugins Js ===-->
    <script src="assets/js/plugins.js"></script>
    <!--=== Active Js ===-->
    <script src="assets/js/active.js"></script>
</body>


</html>


<script type="text/javascript">
    const token = localStorage.getItem('token'); // Lấy token đăng nhập
        const userId = localStorage.getItem('userId');
        

        function renderMiniCart(cartItems, summary) {
            const cartWrapper = document.querySelector(".minicart-item-wrapper ul");
            const pricingBox = document.querySelector(".minicart-pricing-box ul");
    
            // Làm rỗng nội dung cũ
            cartWrapper.innerHTML = "";
            pricingBox.innerHTML = "";
            var tem = 1;
            // Render từng sản phẩm
            cartItems.forEach(item => {
                const product = item.product;
                const quantity = item.quantity;
    
                console.log("pro",product)
    
                const cartItemHTML = `
            <li class="minicart-item">
                <div class="minicart-thumb">
                    <a href="/product-details.html?id=${product.productId}">
                        <img src="http://localhost:8080/images/product/${product.images[0]}" alt="${product.productName}">
                    </a>
                </div>
                <div class="minicart-content">
                    <h3 class="product-name">
                        <a href="/product-details.html?id=${product.productId}">${product.productName}</a>
                    </h3>
                    <p>
                        <span class="cart-quantity">${quantity} <strong>&times;</strong></span>
                        <span class="cart-price">$${(quantity * 100).toFixed(2)}</span>
                    </p>
                </div>
                <button class="minicart-remove"><i class="ion-android-close"></i></button>
            </li>
        `;
                cartWrapper.innerHTML += cartItemHTML;
            });
    
            // Render tổng giá trị
            pricingBox.innerHTML += `
        <li><span>sub-total</span><span><strong>$${summary.totalPrice.toFixed(2)}</strong></span></li>
        <li><span>VAT (10%)</span><span><strong>$${(summary.totalPrice * 0.1).toFixed(2)}</strong></span></li>
        <li class="total"><span>total</span><span><strong>$${(summary.totalPrice * 1.1).toFixed(2)}</strong></span></li>
    `;
        }
    
        async function fetchCartItems(userId) {
            try {
                const response = await fetch(`http://localhost:8080/cart?userId=${userId}`, {
                    method: "GET",
                    headers: {
                        "Authorization": token,
                        "Content-Type": "application/json"
                    }
                });
                const data = await response.json();
                if (data.code === 200) {
                    return data.result;
                } else {
                    throw new Error(data.message || "Failed to fetch cart items.");
                }
            } catch (error) {
                console.error("Error fetching cart items:", error);
                return [];
            }
        }
    
        async function fetchCartSummary(userId) {
            try {
                const [quantityRes, priceRes] = await Promise.all([
                    fetch(`http://localhost:8080/cart/quantity?userId=${userId}`, {
                        method: "GET",
                        headers: {
                            "Authorization": token,
                            "Content-Type": "application/json"
                        }
                    }).then(res => res.json()),
                    fetch(`http://localhost:8080/cart/sumprice?userId=${userId}`, {
                        method: "GET",
                        headers: {
                            "Authorization": token,
                            "Content-Type": "application/json"
                        }
                    }).then(res => res.json())
                ]);
                return {
                    totalQuantity: quantityRes,
                    totalPrice: priceRes
                };
            } catch (error) {
                console.error("Error fetching cart summary:", error);
                return { totalQuantity: 0, totalPrice: 0 };
            }
        }
    
    
        document.addEventListener("DOMContentLoaded", async () => {
    
            // Gọi API lấy dữ liệu
            const cartItems = await fetchCartItems(userId);
            const cartSummary = await fetchCartSummary(userId);
    
            // Render dữ liệu ra giao diện
            renderMiniCart(cartItems, cartSummary);
        });
    
        document.addEventListener("click", async (event) => {
            if (event.target.classList.contains("minicart-remove")) {
                const productElement = event.target.closest(".minicart-item");
                const variantId = productElement.querySelector("a").href.split("variantId=")[1];
    
                try {
                    await fetch(`http://localhost:8080/cart/remove?variantId=${variantId}`, {
                        method: "DELETE",
                        headers: {
                            "Authorization": token,
                            "Content-Type": "application/json"
                        }
                    });
                    productElement.remove(); // Xóa khỏi giao diện
                } catch (error) {
                    console.error("Error removing cart item:", error);
                }
            }
        });

    document.addEventListener('DOMContentLoaded', async () => {
        const token = localStorage.getItem('token'); // Lấy token đăng nhập
        const id = localStorage.getItem('userId');
        const productContainer = document.querySelector('.product-carousel'); // Container chứa sản phẩm

        const topProductContainer = document.querySelector('.top-seller-carousel'); // Container chứa sản phẩm
    
        if (!token) {
            console.error('User is not logged in. Token is missing.');
            return;
        }
    
        try {
            // Gọi API lấy danh sách sản phẩm
            const response = await fetch('http://localhost:8080/product?page=0&size=10', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
    
            if (!response.ok) {
                throw new Error(`Error fetching products: ${response.statusText}`);
            }
    
            const data = await response.json();
            const products = data.result.result;

            console.log("product:", data);
    
            productContainer.innerHTML = '';
            
    
            for (const product of products) {
                // Gọi API lấy danh sách ảnh của từng sản phẩm

                let productImage = product.images && product.images.length > 0 ? product.images[0] : 'assets/img/default-image.jpg';
                
                const productHTML = `
                    <div class="product-item mb-50">
                                <div class="product-thumb">
                                    <a href="product-details.html?id=${product.productId}">
                                        <img src="http://localhost:8080/images/product/${product.images[0]}" alt="">
                                    </a>
                                </div>
                                <div class="product-content">
                                    <h5 class="product-name">
                                        <a href="product-details.html">${product.productName}</a>
                                    </h5>
                                    <div class="price-box">
                                        <span class="price-regular">${product.price * (100 - product.discount) / 100} VND</span>
                                        <span class="price-old"><del>${product.price}</del></span>
                                    </div>
                                    <div class="product-action-link">
                                        <a href="#" data-bs-toggle="tooltip" title="Wishlist"><i
                                                class="ion-android-favorite-outline"></i></a>
                                        <a href="product-details.html?id=${product.productId}" data-bs-toggle="tooltip" title="Add To Cart"><i
                                                class="ion-bag"></i></a>
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#quick_view" data-product-id="${product.productId}"> <span
                                                data-bs-toggle="tooltip" title="Quick View"><i
                                                    class="ion-ios-eye-outline"></i></span> </a>
                                    </div>
                                </div>
                            </div>
                `;

                productContainer.insertAdjacentHTML('beforeend', productHTML);
            }

            // Khởi tạo slider sau khi thêm sản phẩm
            $('.product-carousel').slick({
                slidesToShow: 4, // Hiển thị 4 sản phẩm
                infinite: true,
                arrows: true, // Hiển thị nút điều hướng
                prevArrow: '<button type="button" class="slick-prev"><i class="fa fa-angle-left"></i></button>',
                nextArrow: '<button type="button" class="slick-next"><i class="fa fa-angle-right"></i></button>',
                responsive: [
                    {
                        breakpoint: 1024,
                        settings: {
                            slidesToShow: 3
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 2
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: 1
                        }
                    }
                ]
            });


            // Add Quick View event listeners
            document.querySelectorAll('[data-bs-target="#quick_view"]').forEach(button => {
                button.addEventListener('click', async (event) => {
                    const productId = event.currentTarget.getAttribute('data-product-id');
                    await fetchQuickViewProduct(productId);
                });
            });
        } catch (error) {
            console.error('Error fetching products or images:', error);
        } 

    });

    // Lấy chi tiết sản phẩm từ API và hiển thị vào modal
    async function fetchQuickViewProduct(productId) {
        try {
            const response = await fetch(`http://localhost:8080/product/${productId}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error(`Failed to fetch product details: ${response.statusText}`);
            }

            const data = await response.json();
            const product = data.result;

            // Hiển thị thông tin sản phẩm vào modal
            document.getElementById('productName-1').innerText = product.productName;
            document.getElementById('currentPrice-1').innerText = `$${(product.price * (100 - product.discount) / 100).toFixed(2)}`;
            document.getElementById('oldPrice-1').innerText = product.discount ? `$${product.price}` : '';
            document.getElementById('description-1').innerText = product.description;
            document.getElementById("qvId").textContent = product.productId;
            document.getElementById("availability").textContent = product.soldQuantity;

            // Cập nhật hình ảnh chính và hình ảnh thumbnail
            const mainImage = product.images && product.images[0] ? `http://localhost:8080/images/product/${product.images[0]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('mainImage-1').src = mainImage;

            const thumbnails = product.images || [];
            document.getElementById('thumb1-1').src = thumbnails[0] ? `http://localhost:8080/images/product/${thumbnails[0]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb2-1').src = thumbnails[1] ? `http://localhost:8080/images/product/${thumbnails[1]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb3-1').src = thumbnails[2] ? `http://localhost:8080/images/product/${thumbnails[2]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb4-1').src = thumbnails[3] ? `http://localhost:8080/images/product/${thumbnails[3]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb5-1').src = thumbnails[3] ? `http://localhost:8080/images/product/${thumbnails[3]}` : 'http://localhost:8080/images/product/default-image.jpg';

            // Hiển thị modal
            const quickViewModal = new bootstrap.Modal(document.getElementById('quick_view'));
            quickViewModal.show();
        } catch (error) {
            console.error('Error fetching product details:', error);
        }
    }

    // Thêm sự kiện cho các nút Quick View
    document.querySelectorAll('[data-bs-target="#quick_view"]').forEach(button => {
        button.addEventListener('click', (event) => {
            const productId = event.currentTarget.getAttribute('data-product-id');
            const token = localStorage.getItem('token'); // Token từ localStorage
            if (token) {
                fetchQuickViewProduct(productId, token);
            } else {
                alert('You need to log in to view this product!');
            }
        });
    });

    const id = localStorage.getItem('userId');

   // Hàm để fetch thông tin sản phẩm từ API và cập nhật DOM
    async function fetchProductDetails(productId) {
        try {
            const response = await fetch(`http://localhost:8080/product/${productId}`);
            const token = localStorage.getItem('token');
            const id = localStorage.getItem('userId');
            if (!response.ok) {
                throw new Error('Error fetching product details');
            }

            const data = await response.json();
            const product = data.result;

            // Cập nhật thông tin sản phẩm vào DOM
            document.getElementById('productName').innerText = product.productName;
            document.getElementById('currentPrice').innerText = `$${(product.price * (100 - product.discount) / 100).toFixed(2)}`;
            document.getElementById('oldPrice').innerText = product.discount ? `$${product.price}` : '';
            document.getElementById('description').innerText = product.description;
            document.getElementById('availability').innerText = product.availability ? 'In Stock' : 'Out of Stock';
            document.getElementById('availability').classList.toggle('text-success', product.availability);
            document.getElementById('availability').classList.toggle('text-danger', !product.availability);
            document.getElementById('des').innerText = product.description; 

            // Cập nhật hình ảnh chính
            const mainImage = `http://localhost:8080/images/product/${product.images[0]}`;
                        document.getElementById('mainImage').src = mainImage;

                        const thumbnails = product.images || [];
                        console.log("thm",thumbnails)
            document.getElementById('thumb1').src = thumbnails[0] ? `http://localhost:8080/images/product/${thumbnails[0]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb2').src = thumbnails[1] ? `http://localhost:8080/images/product/${thumbnails[1]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb3').src = thumbnails[2] ? `http://localhost:8080/images/product/${thumbnails[2]}` : 'http://localhost:8080/images/product/default-image.jpg';
            document.getElementById('thumb4').src = thumbnails[3] ? `http://localhost:8080/images/product/${thumbnails[3]}` : 'http://localhost:8080/images/product/default-image.jpg';

        } catch (error) {
            console.error(error);
        }
    }

    async function fetchAndDisplayProductVariants(productId) {
        try {
            const response = await fetch(`http://localhost:8080/product/variants/${productId}`);
            if (!response.ok) throw new Error('Failed to fetch product variants');
    
            const data = await response.json();
            const variants = data.result;
            const variantsTableBody = document.getElementById('product-variants');
            variantsTableBody.innerHTML = ''; // Xóa dữ liệu cũ
    
            variants.forEach(variant => {
                const row = document.createElement('tr');
    
                const nameCell = document.createElement('td');
                nameCell.textContent = variant.size; // Tên biến thể
                row.appendChild(nameCell);
    
                const valueCell = document.createElement('td');
                valueCell.textContent = variant.color; // Giá trị biến thể
                row.appendChild(valueCell);
    
                variantsTableBody.appendChild(row);
            });
        } catch (error) {
            console.error('Error fetching product variants:', error);
        }
    }

    // Phóng to ảnh chính khi di chuột
    const mainImage = document.getElementById('mainImage');
    const thumbnails = document.querySelectorAll('.thumbnail');
    const mainImage_1 = document.getElementById('mainImage-1');
    const thumbnails_1 = document.querySelectorAll('.thumbnail-1');

    // Thay đổi ảnh chính khi bấm vào thumbnail
    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', (event) => {
            const newImageSrc = event.target.src;
            mainImage.src = newImageSrc;
        });
    });
    thumbnails_1.forEach(thumbnail => {
        thumbnail.addEventListener('click', (event) => {
            const newImageSrc = event.target.src;
            mainImage_1.src = newImageSrc;
        });
    });

    // Di chuột để phóng to vùng ảnh
    mainImage.addEventListener('mousemove', (event) => {
        const bounds = mainImage.getBoundingClientRect();
        const xPercent = ((event.clientX - bounds.left) / bounds.width) * 100;
        const yPercent = ((event.clientY - bounds.top) / bounds.height) * 100;
        mainImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    });
    mainImage_1.addEventListener('mousemove', (event) => {
        const bounds = mainImage_1.getBoundingClientRect();
        const xPercent = ((event.clientX - bounds.left) / bounds.width) * 100;
        const yPercent = ((event.clientY - bounds.top) / bounds.height) * 100;
        mainImage_1.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    });
    mainImage.addEventListener('mouseleave', () => {
        mainImage.style.transformOrigin = 'center center';
    });
    mainImage_1.addEventListener('mouseleave', () => {
        mainImage_1.style.transformOrigin = 'center center';
    });

    // logic thêm giỏ hàng
    document.querySelectorAll('.color-box').forEach((box) => {
        box.addEventListener('click', function () {
            document.querySelectorAll('.color-box').forEach((b) => b.classList.remove('selected'));
            this.classList.add('selected');
            console.log("Selected Color:", this.getAttribute('data-color'));
        });
    });

    document.querySelectorAll('.size-box').forEach((box) => {
        box.addEventListener('click', function () {
            document.querySelectorAll('.size-box').forEach((b) => b.classList.remove('selected'));
            this.classList.add('selected');
            console.log("Selected Size:", this.getAttribute('data-size'));
        });
    });

    async function addToCart(id, productId, quantity, size, color) {
        const apiUrl = `http://localhost:8080/cart?userId=${id}&productId=${productId}&quantity=${quantity}&size=${size}&color=${color}`;
        try {
            const response = await fetch(apiUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    // 'Authorization': `Bearer ${token}`, // Thêm nếu cần xác thực
                },
            });

            if (!response.ok) {
                throw new Error(`Failed to add to cart: ${response.status}`);
            }

            // Kiểm tra Content-Type để xử lý phản hồi phù hợp
            const contentType = response.headers.get("Content-Type");
            let data;

            if (contentType && contentType.includes("application/json")) {
                data = await response.json(); // Xử lý nếu là JSON
            } else {
                data = await response.text(); // Xử lý nếu là text
            }

            // Kiểm tra nội dung phản hồi
            if (typeof data === "string") {
                console.log("Response message:", data);
                alert(data); // Hiển thị thông báo cho người dùng
                location.reload();
            } else if (data.code === 200) {
                console.log("Product added to cart successfully:", data.message);
                alert(data.message || "Product added successfully!");
            } else {
                console.error("Error adding to cart:", data.message);
                alert("Failed to add product to cart!");
            }
        } catch (error) {
            console.error("Error during add-to-cart operation:", error);
            alert("An error occurred while adding the product to the cart.");
        }
    }



    document.getElementById("addToCart").addEventListener("click", function () {
        const selectedColor = document.querySelector('.color-box.selected')?.getAttribute('data-color');
        const selectedSize = document.querySelector('.size-box.selected')?.getAttribute('data-size');
        const quantity = document.getElementById("quantityInput").value;
        const qvId = document.getElementById("qvId").textContent.trim();
        console.log("abc" + qvId);

        if (!selectedColor || !selectedSize) {
            alert("Please select both color and size.");
            return;
        }


        console.log("Add to Cart:", { color: selectedColor, size: selectedSize, quantity });

        // Logic thêm sản phẩm vào giỏ hàng
        addToCart(id, qvId, quantity, selectedSize, selectedColor);
    });
    


    // Hàm để lấy tham số từ URL
    function getUrlParameter(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param); // Trả về giá trị của tham số
    }
    

    // Gọi API khi trang được tải
    window.addEventListener('DOMContentLoaded', () => {
        // Lấy productId từ URL
        const productId = getUrlParameter('id');
        if (productId) {
            // Gọi hàm để fetch chi tiết sản phẩm
            fetchProductDetails(productId);
            fetchAndDisplayProductVariants(productId);

            document.getElementById("addToCart2").addEventListener("click", function () {
                const selectedColor = document.querySelector('.color-box.selected')?.getAttribute('data-color');
                const selectedSize = document.querySelector('.size-box.selected')?.getAttribute('data-size');
                const quantity = document.getElementById("quantityInput").value;
                const qvId = document.getElementById("qvId").textContent.trim();
                console.log("abc" + qvId);
        
                if (!selectedColor || !selectedSize) {
                    alert("Please select both color and size.");
                    return;
                }
        
        
                console.log("Add to Cart:", { color: selectedColor, size: selectedSize, quantity });
        
                // Logic thêm sản phẩm vào giỏ hàng
                addToCart(id, productId, quantity, selectedSize, selectedColor);
            });
        } else {
            console.error('Product ID not found in URL');
            // Bạn có thể chuyển hướng về trang danh sách hoặc hiển thị thông báo lỗi ở đây
        }
    });

    //số lượng sp trong giỏ hàng
    $.ajax({
        url: "http://localhost:8080/cart/quantity",
        data: { userId: id },
        type: "GET",
        success: function (response) {
            let numberOfProduct = response.result;
            console.log("Aa",response);
            $('#cart-quantity').text(numberOfProduct)
        }
    })

</script>

<style>
    /* modal */
    .img-thumbnail {
        width: 125px;
        height: 125px;
    }
    .price-box .price-regular {
        font-size: 18px;
        font-weight: bold;
        color: #000;
    }
    .price-box .price-old {
        font-size: 16px;
        text-decoration: line-through;
    }
    .availability span {
        font-weight: bold;
    }

    .product-item {
        margin: 0 10px;
        text-align: center;
    }
    .product-thumb img {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
    }
    .zoomable {
        transition: transform 0.2s ease-in-out;
        cursor: zoom-in;
    }
    
    .product-large-slider:hover .zoomable {
        transform: scale(2); /* Phóng to khi hover */
        cursor: zoom-out;
    }
    
    .thumbnail {
        cursor: pointer;
    }
    
    .product-large-slider {
        position: relative;
        overflow: hidden;
    }

    .user-thumbnail .user-image {
        width: 30px;
        height: 30px;
        border-radius: 30%;
        object-fit: cover;
        border: 1px solid #ddd;
    }
    
    .user-thumbnail a {
        display: inline-block;
        text-decoration: none;
    }

    .color-box {
        width: 30px;
        height: 30px;
        border: 2px solid black;
        cursor: pointer;
        border-radius: 50%;
        /* Làm ô màu thành hình tròn */
    }

    .color-box.selected {
        border: 2px solid #3cfd6c;
        /* Viền để phân biệt ô được chọn */
    }

    .size-box {
        width: 40px;
        height: 40px;
        line-height: 40px;
        text-align: center;
        border: 2px solid #ddd;
        cursor: pointer;
        border-radius: 5px;
        font-weight: bold;
    }

    .size-box.selected {
        border: 2px solid #000;
        background-color: #f0f0f0;
    }
</style>